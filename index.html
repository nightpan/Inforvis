<!DOCTYPE html>
<html>

<head>
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" charset="utf-8">
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="topojson.v1.min.js" charset="big5"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>

</head>
<style>
    body {
        background-color: #fff;
        /* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#398fd6+5,7db9e8+76 */
        background: #398fd6;
        /* Old browsers */
        background: -moz-linear-gradient(-45deg, #398fd6 5%, #7db9e8 76%);
        /* FF3.6-15 */
        background: -webkit-linear-gradient(-45deg, #398fd6 5%, #7db9e8 76%);
        /* Chrome10-25,Safari5.1-6 */
        background: linear-gradient(135deg, #398fd6 5%, #7db9e8 76%);
        /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
        filter: progid: DXImageTransform.Microsoft.gradient( startColorstr='#398fd6', endColorstr='#7db9e8', GradientType=1);

        /* IE6-9 fallback on horizontal gradient */
    }

    /*.toolTip{
    position: absolute;
    border: #7db9e8;
    background: #fff;
}*/

    .toolTip {
        position: absolute;
        text-align: left;
        width: 250px;
        height: 100px;
        padding: 5px;
        font: 15px sans-serif;
        background: steelblue;
        color: white;
        border: 0px;
        border-radius: 3px;
        pointer-events: none;
        top: 0;
        left: 0;
        opacity: 0;

    }

    /*
    .slider1{
        //top : 40;
        width: 100%;
    }*/

    #slider {
        width: 800px;
        margin: auto;
    }
    #slidermark{
        width:800px;
    }
    .subunit-boundary {
        fill: none;
        stroke: #227700;
        stroke-dasharray: 5, 0;
        stroke-linejoin: round;
    }

    svg {
        display: block;
        margin: auto;
    }
</style>

<body>
    <script type="text/javascript" charset="big5">
        let data96 = [{
                "region": "新北市",
                "COUNTYID": "F",
                "number": 386,
                "pepople_number": 3767644,
                "avege_number": 9761,
                "sales": 2894712

            },
            {
                "region": "臺北市",
                "COUNTYID": "A",
                "number": 680,
                "pepople_number": 2608522,
                "avege_number": 3836,
                "sales": 14472051

            },
            {
                "region": "桃園市",
                "COUNTYID": "H",
                "number": 219,
                "pepople_number": 1916420,
                "avege_number": 8751,
                "sales": 1539439

            },
            {
                "region": "台中市",
                "COUNTYID": "B",
                "number": 436,
                "pepople_number": 2583736,
                "avege_number": 5926,
                "sales": 2581715

            },
            {
                "region": "台南市",
                "COUNTYID": "D",
                "number": 251,
                "pepople_number": 1855648,
                "avege_number": 7393,
                "sales": 4723968

            },
            {
                "region": "高雄市",
                "COUNTYID": "E",
                "number": 314,
                "pepople_number": 2743372,
                "avege_number": 8737,
                "sales": 1885188

            },
            {
                "region": "宜蘭縣",
                "COUNTYID": "G",
                "number": 55,
                "pepople_number": 456836,
                "avege_number": 8306,
                "sales": 242589

            },
            {
                "region": "新竹縣",
                "COUNTYID": "J",
                "number": 67,
                "pepople_number": 489986,
                "avege_number": 7313,
                "sales": 186569

            },
            {
                "region": "苗栗縣",
                "COUNTYID": "K",
                "number": 65,
                "pepople_number": 555198,
                "avege_number": 8542,
                "sales": 264049

            },
            {
                "region": "彰化縣",
                "COUNTYID": "N",
                "number": 120,
                "pepople_number": 1302683,
                "avege_number": 10856,
                "sales": 712780

            },
            {
                "region": "南投縣",
                "COUNTYID": "M",
                "number": 68,
                "pepople_number": 529436,
                "avege_number": 7786,
                "sales": 263710

            },
            {
                "region": "雲林縣",
                "COUNTYID": "P",
                "number": 55,
                "pepople_number": 719615,
                "avege_number": 13084,
                "sales": 237724

            },
            {
                "region": "嘉義縣",
                "COUNTYID": "Q",
                "number": 50,
                "pepople_number": 275766,
                "avege_number": 5515,
                "sales": 134398

            },
            {
                "region": "屏東縣",
                "COUNTYID": "T",
                "number": 77,
                "pepople_number": 882849,
                "avege_number": 11466,
                "sales": 263145

            },
            {
                "region": "連江縣",
                "COUNTYID": "Z",
                "number": 0,
                "pepople_number": 9843,
                "avege_number": 0,
                "sales": 0
            },
            {
                "region": "花蓮縣",
                "COUNTYID": "U",
                "number": 67,
                "pepople_number": 340633,
                "avege_number": 5084,
                "sales": 213269

            },
            {
                "region": "澎湖縣",
                "COUNTYID": "X",
                "number": 14,
                "pepople_number": 91652,
                "avege_number": 6547,
                "sales": 21745
            },
            {
                "region": "基隆市",
                "COUNTYID": "C",
                "number": 29,
                "pepople_number": 387656,
                "avege_number": 13367,
                "sales": 112093
            },
            {
                "region": "新竹市",
                "COUNTYID": "O",
                "number": 88,
                "pepople_number": 394349,
                "avege_number": 4481,
                "sales": 804892
            },
            {
                "region": "嘉義市",
                "COUNTYID": "I",
                "number": 69,
                "pepople_number": 271074,
                "avege_number": 3929,
                "sales": 400082
            },
            {
                "region": "金門縣",
                "COUNTYID": "W",
                "number": 13,
                "pepople_number": 80654,
                "avege_number": 6204,
                "sales": 8503
            },
            {
                "region": "台東縣",
                "COUNTYID": "V",
                "number": 13,
                "pepople_number": 80654,
                "avege_number": 6204,
                "sales": 8503
            }
        ];

        var density97 = {
            "A": -4, // 台北市
            "I": -1, //嘉義市
            "O": 0, //新竹市
            "C": -14, //基隆市
            "F": -4, //新北市
            "H": -2, //桃園市
            "B": -0, //台中市
            "N": 4, //彰化縣
            "E": -2, //高雄市
            "D": -4, //台南市
            "W": -15, //金門縣
            "X": 14, //澎湖縣
            "P": 4, //雲林縣
            "Z": 0, //連江縣
            "J": -6, //新竹縣
            "K": 9, //苗栗縣
            "T": 10, //屏東縣
            "Q": -10, //嘉義縣
            "G": 0, //宜蘭縣
            "M": 0, //南投縣
            "U": 4, //花蓮縣
            "V": -4 //台東縣
        };
        var density98 = {
            "A": -7, // 台北市
            "I": -6, //嘉義市
            "O": -10, //新竹市
            "C": -10, //基隆市
            "F": -5, //新北市
            "H": -1, //桃園市
            "B": 0, //台中市
            "N": 0, //彰化縣
            "E": -2, //高雄市
            "D": -3, //台南市
            "W": 8, //金門縣
            "X": 0, //澎湖縣
            "P": 9, //雲林縣
            "Z": 0, //連江縣
            "J": -10, //新竹縣
            "K": 2, //苗栗縣
            "T": 8, //屏東縣
            "Q": -8, //嘉義縣
            "G": 2, //宜蘭縣
            "M": -6, //南投縣
            "U": -4, //花蓮縣
            "V": -4 //台東縣
        };
        var density99 = {
            "A": -8, // 台北市
            "I": -14, //嘉義市
            "O": -17, //新竹市
            "C": -17, //基隆市
            "F": -9, //新北市
            "H": -1, //桃園市
            "B": -3, //台中市
            "N": -3, //彰化縣
            "E": -2, //高雄市
            "D": -5, //台南市
            "W": 15, //金門縣
            "X": 0, //澎湖縣
            "P": 9, //雲林縣
            "Z": 0, //連江縣
            "J": -19, //新竹縣
            "K": -5, //苗栗縣
            "T": 1, //屏東縣
            "Q": -6, //嘉義縣
            "G": -5, //宜蘭縣
            "M": -6, //南投縣
            "U": -12, //花蓮縣
            "V": -4 //台東縣
        };
        var density100 = {
            "A": -10, // 台北市
            "I": -17, //嘉義市
            "O": -17, //新竹市
            "C": -31, //基隆市
            "F": -5, //新北市
            "H": -7, //桃園市
            "B": -5, //台中市
            "N": -1, //彰化縣
            "E": -2, //高雄市
            "D": -7, //台南市
            "W": 8, //金門縣
            "X": 0, //澎湖縣
            "P": 13, //雲林縣
            "Z": 0, //連江縣
            "J": -18, //新竹縣
            "K": -9, //苗栗縣
            "T": -4, //屏東縣
            "Q": -10, //嘉義縣
            "G": -13, //宜蘭縣
            "M": -7, //南投縣
            "U": -12, //花蓮縣
            "V": -4 //台東縣
        };
        var density101 = {
            "A": -14, // 台北市
            "I": -22, //嘉義市
            "O": -17, //新竹市
            "C": -34, //基隆市
            "F": -8, //新北市
            "H": -4, //桃園市
            "B": -12, //台中市
            "N": -1, //彰化縣
            "E": -6, //高雄市
            "D": -6, //台南市
            "W": 31, //金門縣
            "X": -7, //澎湖縣
            "P": 13, //雲林縣
            "Z": 0, //連江縣
            "J": -25, //新竹縣
            "K": -8, //苗栗縣
            "T": -6, //屏東縣
            "Q": -14, //嘉義縣
            "G": -13, //宜蘭縣
            "M": -10, //南投縣
            "U": -13, //花蓮縣
            "V": 0 //台東縣
        };
        var density102 = {
            "A": -26, // 台北市
            "I": -23, //嘉義市
            "O": -38, //新竹市
            "C": -48, //基隆市
            "F": -27, //新北市
            "H": -26, //桃園市
            "B": -31, //台中市
            "N": -29, //彰化縣
            "E": -19, //高雄市
            "D": -14, //台南市
            "W": 8, //金門縣
            "X": -29, //澎湖縣
            "P": -16, //雲林縣
            "Z": 0, //連江縣
            "J": -43, //新竹縣
            "K": -23, //苗栗縣
            "T": -27, //屏東縣
            "Q": -36, //嘉義縣
            "G": -24, //宜蘭縣
            "M": -41, //南投縣
            "U": -27, //花蓮縣
            "V": -41 //台東縣
        };
        var density103 = {
            "A": -30, // 台北市
            "I": -23, //嘉義市
            "O": -42, //新竹市
            "C": -45, //基隆市
            "F": -28, //新北市
            "H": -33, //桃園市
            "B": -31, //台中市
            "N": -33, //彰化縣
            "E": -22, //高雄市
            "D": -18, //台南市
            "W": 15, //金門縣
            "X": -29, //澎湖縣
            "P": -20, //雲林縣
            "Z": 0, //連江縣
            "J": -39, //新竹縣
            "K": -28, //苗栗縣
            "T": -27, //屏東縣
            "Q": -40, //嘉義縣
            "G": -22, //宜蘭縣
            "M": -46, //南投縣
            "U": -34, //花蓮縣
            "V": -44 //台東縣
        };
        var density104 = {
            "A": -30, // 台北市
            "I": -20, //嘉義市
            "O": -40, //新竹市
            "C": -45, //基隆市
            "F": -33, //新北市
            "H": -33, //桃園市
            "B": -34, //台中市
            "N": -32, //彰化縣
            "E": -21, //高雄市
            "D": -17, //台南市
            "W": 0, //金門縣
            "X": -36, //澎湖縣
            "P": -27, //雲林縣
            "Z": 0, //連江縣
            "J": -39, //新竹縣
            "K": -31, //苗栗縣
            "T": -23, //屏東縣
            "Q": -42, //嘉義縣
            "G": -27, //宜蘭縣
            "M": -46, //南投縣
            "U": -36, //花蓮縣
            "V": -48 //台東縣
        };
        var density105 = {
            "A": -32, // 台北市
            "I": -22, //嘉義市
            "O": -44, //新竹市
            "C": -41, //基隆市
            "F": -35, //新北市
            "H": -33, //桃園市
            "B": -34, //台中市
            "N": -32, //彰化縣
            "E": -25, //高雄市
            "D": -19, //台南市
            "W": 0, //金門縣
            "X": -36, //澎湖縣
            "P": -29, //雲林縣
            "Z": 0, //連江縣
            "J": -33, //新竹縣
            "K": -25, //苗栗縣
            "T": -25, //屏東縣
            "Q": -48, //嘉義縣
            "G": -22, //宜蘭縣
            "M": -46, //南投縣
            "U": -36, //花蓮縣
            "V": -52 //台東縣
        };
        var density106 = {
            "A": -35, // 台北市
            "I": -25, //嘉義市
            "O": -43, //新竹市
            "C": -38, //基隆市
            "F": -39, //新北市
            "H": -34, //桃園市
            "B": -35, //台中市
            "N": -37, //彰化縣
            "E": -25, //高雄市
            "D": -20, //台南市
            "W": 0, //金門縣
            "X": -36, //澎湖縣
            "P": -31, //雲林縣
            "Z": 0, //連江縣
            "J": -28, //新竹縣
            "K": -29, //苗栗縣
            "T": -26, //屏東縣
            "Q": -50, //嘉義縣
            "G": -22, //宜蘭縣
            "M": -46, //南投縣
            "U": -40, //花蓮縣
            "V": -44 //台東縣
        };
    </script>


</body>
<script>
       function change() {
            a = document.getElementById('slider').value;
            console.log(a);
        }
    jQuery(function () {
        var width = 800,
            height = 600;
        var svg = d3.select("body")
            .append("svg")
            .attr("width", width)
            .attr("height", height);
        var projection = d3.geo.mercator()
            .center([122.5, 24])
            .scale(6000);

        var path = d3.geo.path()
            .projection(projection);

        var tooltip = d3.select("body").append("div").attr("class", "toolTip");
        //畫出起始圖
        d3.json("taiwan.json", function (error, topology) {
            var g = svg.append("g");
            // 縣市/行政區界線
            d3.select("svg").append("path").datum(
                topojson.mesh(topology,
                    topology.objects["County_MOI_1060525"],
                    function (a,
                        b) {
                        return a !== b;
                    })).attr("d", path).attr("class", "subunit-boundary");

            d3.select("g").selectAll("path")
                .data(topojson.feature(topology, topology.objects.County_MOI_1060525).features)
                .enter()
                .append("path")
                .attr("class", "state-path")
                .attr("d", path)
                .attr({
                    d: path,
                    name: function (d) {
                        return d.properties["COUNTYNAME"];
                    },
                    fill: function (d) {
                        var color = d3.scale.linear()
                            .domain([-50, 0, 15])
                            .range(["red", "white", "green"]);
                        return color(density97[d.properties.COUNTYID]);
                    },
                    stroke: "black"
                }).attr('stroke-width', "1")
                .on("mouseover", function (d) {
                    //d3.select(this).attr("fill", "#227700");
                    tooltip.transition().duration(10).style("opacity", 1);
                    let i;

                    for (i = 0; i < data96.length; i++) {
                        if (d.properties.COUNTYID == data96[i].COUNTYID) {

                            tooltip.html(d.properties.COUNTYNAME + "<br> 書店數目： " + data96[i].number +
                                    "<br> 縣市人口數：" + data96[i].pepople_number + "<br>平均多少人享有一間書店： " +
                                    data96[i].avege_number + "<br> 銷售總額：" + data96[i].sales)
                                .style("left", d3.event.pageX + "px")
                                .style("top", d3.event.pageY + "px");
                        }


                    }
                }).on("mouseleave", function (d) {
                    //d3.select(this).attr("fill", "#fff");
                    tooltip.transition().duration(500).style("opacity", 0);
                });
            //帶入不同年代的資料
            d3.select("g").selectAll("path")
                .transition()
                .duration(2000)
                .attr({
                    d: path,
                    fill: function (d) {
                        var color = d3.scale.linear()
                            .domain([-50, 0, 15])
                            .range(["red", "white", "green"]);
                        return color(density98[d.properties.COUNTYID]);
                    }
                });
            d3.select("g").selectAll("path")
                .transition()
                .delay(2000)
                .duration(2000)
                .attr({
                    d: path,
                    fill: function (d) {
                        var color = d3.scale.linear()
                            .domain([-50, 0, 15])
                            .range(["red", "white", "green"]);
                        return color(density99[d.properties.COUNTYID]);
                    }
                });
            d3.select("g").selectAll("path")
                .transition()
                .delay(4000)
                .duration(2000)
                .attr({
                    d: path,
                    fill: function (d) {
                        var color = d3.scale.linear()
                            .domain([-50, 0, 15])
                            .range(["red", "white", "green"]);
                        return color(density100[d.properties.COUNTYID]);
                    }
                });
            d3.select("g").selectAll("path")
                .transition()
                .delay(6000)
                .duration(2000)
                .attr({
                    d: path,
                    fill: function (d) {
                        var color = d3.scale.linear()
                            .domain([-50, 0, 15])
                            .range(["red", "white", "green"]);
                        return color(density101[d.properties.COUNTYID]);
                    }
                });
            d3.select("g").selectAll("path")
                .transition()
                .delay(8000)
                .duration(2000)
                .attr({
                    d: path,
                    fill: function (d) {
                        var color = d3.scale.linear()
                            .domain([-50, 0, 15])
                            .range(["red", "white", "green"]);
                        return color(density102[d.properties.COUNTYID]);
                    }
                });
            d3.select("g").selectAll("path")
                .transition()
                .delay(10000)
                .duration(2000)
                .attr({
                    d: path,
                    fill: function (d) {
                        var color = d3.scale.linear()
                            .domain([-50, 0, 15])
                            .range(["red", "white", "green"]);
                        return color(density103[d.properties.COUNTYID]);
                    }
                });
            d3.select("g").selectAll("path")
                .transition()
                .delay(12000)
                .duration(2000)
                .attr({
                    d: path,
                    fill: function (d) {
                        var color = d3.scale.linear()
                            .domain([-50, 0, 15])
                            .range(["red", "white", "green"]);
                        return color(density104[d.properties.COUNTYID]);
                    }
                });
            d3.select("g").selectAll("path")
                .transition()
                .delay(14000)
                .duration(2000)
                .attr({
                    d: path,
                    fill: function (d) {
                        var color = d3.scale.linear()
                            .domain([-50, 0, 15])
                            .range(["red", "white", "green"]);
                        return color(density105[d.properties.COUNTYID]);
                    }
                });
            d3.select("g").selectAll("path")
                .transition()
                .delay(16000)
                .duration(2000)
                .attr({
                    d: path,
                    fill: function (d) {
                        var color = d3.scale.linear()
                            .domain([-50, 0, 15])
                            .range(["red", "white", "green"]);
                        return color(density106[d.properties.COUNTYID]);
                    }
                });

            //產生滑軸
            d3.select("body").append("div").attr("class", "slider1")
                .append("input")
                .attr("type", "range")
                .attr("id", "slider")
                .attr("min", "97")
                .attr("max", "106")
                .attr("step", "null")
                .attr("mark", "{number:97,98,99,100,101,102,103,104,105,106}")
                .attr("oninput", "change()");
            var count = 97
            var length = 0
            for(count = 97 ;count<107;count++)
            {

            d3.select(".slider1")
               .append("span")
               .attr("id","slidermark")
               .attr({
                    left : function(){
                       return length + "%";
                   }
               })
               .html(count);

               length = length+10;
               }

        });
    })


</script>

</html>